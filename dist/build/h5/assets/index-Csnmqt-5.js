import{_ as ve,a as i,o as ue,A as he,y as pe,s as we,c as l,q as R,b as o,w as _e,g as r,n as z,F as J,e as K,z as ge,j as x,t as k,p as me,k as ye,u as fe,x as xe,l as n}from"./index-DDlqzt3H.js";import{w as I}from"./services-GkRl5Aq9.js";import"./request-CIZjav-Z.js";const c=T=>(me("data-v-1ee5c016"),T=T(),ye(),T),ke={class:"page-container"},be=R('<view class="bg-elements" data-v-1ee5c016><view class="bg-gradient" data-v-1ee5c016></view><view class="bg-grid" data-v-1ee5c016></view><view class="bg-circle circle1" data-v-1ee5c016></view><view class="bg-circle circle2" data-v-1ee5c016></view></view>',1),Ce={class:"content-wrapper"},ze={class:"tab-navigation"},Te=c(()=>o("text",null,"视频",-1)),Me={key:0,class:"tab-indicator"},Se=c(()=>o("text",null,"声音",-1)),Ve={key:0,class:"tab-indicator"},Ie={key:0,class:"tab-content"},He={class:"assets-grid"},Ue={class:"card-inner"},Be=["onClick"],Ee=["src"],Le=["src"],Re=c(()=>o("view",{class:"preview-glow"},null,-1)),$e={key:2,class:"play-icon"},Ne=c(()=>o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",width:"24",height:"24"},[o("path",{d:"M8 5v14l11-7z"})],-1)),De=[Ne],Fe={class:"asset-name"},Ge={class:"card-actions"},Pe=["onClick"],Ae=c(()=>o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",width:"14",height:"14"},[o("path",{d:"M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"})],-1)),je=c(()=>o("text",null,"下载",-1)),We=[Ae,je],qe=["onClick"],Oe=c(()=>o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",width:"14",height:"14"},[o("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"})],-1)),Je=c(()=>o("text",null,"删除",-1)),Ke=[Oe,Je],Qe={key:0,class:"load-more"},Xe=c(()=>o("view",{class:"loading-spinner small"},null,-1)),Ye=c(()=>o("text",null,"加载更多...",-1)),Ze=[Xe,Ye],et={key:1,class:"no-more-data"},tt=c(()=>o("text",null,"— 没有更多作品了 —",-1)),st=[tt],ot={key:2,class:"empty-state"},at=R('<view class="empty-illustration" data-v-1ee5c016><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="80" height="80" data-v-1ee5c016><defs data-v-1ee5c016><linearGradient id="videoGradient" x1="0%" y1="0%" x2="100%" y2="100%" data-v-1ee5c016><stop offset="0%" stop-color="#6F4CFF" data-v-1ee5c016></stop><stop offset="100%" stop-color="#2F70ED" data-v-1ee5c016></stop></linearGradient></defs><path d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-8 12.5v-9l6 4.5-6 4.5z" fill="url(#videoGradient)" data-v-1ee5c016></path></svg><view class="empty-glow" data-v-1ee5c016></view></view><text class="empty-message" data-v-1ee5c016>期待您的第一个视频作品</text>',2),lt={key:3,class:"loading-state"},nt=c(()=>o("view",{class:"loading-spinner"},null,-1)),ct=c(()=>o("text",null,"加载中...",-1)),it=[nt,ct],rt={key:1,class:"tab-content"},dt={class:"voice-list"},vt={class:"card-inner"},ut=["onClick"],ht={key:0,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",width:"20",height:"20"},pt=c(()=>o("path",{d:"M8 5v14l11-7z"},null,-1)),wt=[pt],_t={key:1,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",width:"20",height:"20"},gt=c(()=>o("path",{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z"},null,-1)),mt=[gt],yt={class:"voice-info"},ft={class:"voice-name"},xt={class:"voice-meta"},kt={key:0,class:"voice-duration"},bt={class:"voice-actions"},Ct=["onClick"],zt=c(()=>o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",width:"16",height:"16"},[o("path",{d:"M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"})],-1)),Tt=[zt],Mt=["onClick"],St=c(()=>o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",width:"16",height:"16"},[o("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"})],-1)),Vt=[St],It=c(()=>o("view",{class:"card-glow"},null,-1)),Ht={key:0,class:"load-more"},Ut=c(()=>o("view",{class:"loading-spinner small"},null,-1)),Bt=c(()=>o("text",null,"加载更多...",-1)),Et=[Ut,Bt],Lt={key:1,class:"no-more-data"},Rt=c(()=>o("text",null,"— 没有更多声音了 —",-1)),$t=[Rt],Nt={key:2,class:"empty-state"},Dt=R('<view class="empty-illustration" data-v-1ee5c016><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="80" height="80" data-v-1ee5c016><defs data-v-1ee5c016><linearGradient id="audioGradient" x1="0%" y1="0%" x2="100%" y2="100%" data-v-1ee5c016><stop offset="0%" stop-color="#43B5FF" data-v-1ee5c016></stop><stop offset="100%" stop-color="#10B981" data-v-1ee5c016></stop></linearGradient></defs><path d="M12 15c1.66 0 2.99-1.34 2.99-3L15 6c0-1.66-1.34-3-3-3S9 4.34 9 6v6c0 1.66 1.34 3 3 3zm-1.2-9.1c0-.66.54-1.2 1.2-1.2s1.2.54 1.2 1.2l-.01 6.2c0 .66-.53 1.2-1.19 1.2s-1.2-.54-1.2-1.2V5.9zm6.5 6.1c0 3-2.54 5.1-5.3 5.1S6.7 15 6.7 12H5c0 3.41 2.72 6.23 6 6.72V22h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z" fill="url(#audioGradient)" data-v-1ee5c016></path></svg><view class="empty-glow" data-v-1ee5c016></view></view><text class="empty-message" data-v-1ee5c016>尚未创建声音作品</text>',2),Ft={key:3,class:"loading-state"},Gt=c(()=>o("view",{class:"loading-spinner"},null,-1)),Pt=c(()=>o("text",null,"加载中...",-1)),At=[Gt,Pt],jt={class:"video-modal-header"},Wt={class:"video-title"},qt=c(()=>o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",width:"24",height:"24"},[o("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})],-1)),Ot=[qt],Jt={class:"video-container"},Kt=c(()=>o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",width:"20",height:"20"},[o("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"})],-1)),Qt=c(()=>o("text",null,"删除",-1)),Xt=[Kt,Qt],Yt=c(()=>o("text",null,"取消",-1)),Zt=[Yt],es={key:1,class:"toast-wrapper"},ts={class:"toast"},ss={key:2,class:"loading-overlay"},os=c(()=>o("view",{class:"loading-content"},[o("view",{class:"loading-spinner"}),o("text",null,"删除中...")],-1)),as=[os],ls={__name:"index",setup(T){const $=fe(),Q=xe(),d=i("avatar"),_=i(null),v=i(null),N=i(!1),D=i(!1),p=i([]),w=i([]),F=i(20),y=i(1),f=i(!0),g=i(!1),m=i(!0),H=i(!1),U=i(null),M=i(null),C=i(!1),B=i(""),S=i(!1),b=i(!1),G=i(null),V=async(t=!0)=>{var s,a;t?(N.value=!0,m.value=!0,y.value=1,p.value=[]):g.value=!0;try{const e=await I.getList("video",{page:y.value,pageSize:F.value}),u=((s=e.data)==null?void 0:s.data)||[];console.log("获取到视频数据:",u),t?p.value=u:p.value=[...p.value,...u];const h=((a=e.data)==null?void 0:a.total)||0;f.value=p.value.length<h,u.length>0&&y.value++}catch(e){console.error("获取视频列表失败:",e),uni.showToast({title:"获取视频列表失败",icon:"none"}),t&&(p.value=[])}finally{t?(N.value=!1,m.value=!1):g.value=!1}},E=async(t=!0)=>{var s,a;t?(D.value=!0,m.value=!0,y.value=1,w.value=[]):g.value=!0;try{const e=await I.getList("voice",{page:y.value,pageSize:F.value}),u=((s=e.data)==null?void 0:s.data)||[];console.log("获取到声音数据:",u),t?w.value=u:w.value=[...w.value,...u];const h=((a=e.data)==null?void 0:a.total)||0;f.value=w.value.length<h,u.length>0&&y.value++}catch(e){console.error("获取音频列表失败:",e),uni.showToast({title:"获取音频列表失败",icon:"none"}),t&&(w.value=[])}finally{t?(D.value=!1,m.value=!1):g.value=!1}},X=()=>{g.value||!f.value||(d.value==="avatar"?V(!1):E(!1))},Y=t=>{const s=t.target.scrollTop,a=t.target.scrollHeight,e=t.target.clientHeight;a-s-e<100&&!g.value&&f.value&&X()},P=t=>{d.value=t,y.value=1,f.value=!0,t==="avatar"?V():E(),_.value=null};ue(()=>{Z(),V();const t=document.createElement("link");t.rel="icon",t.href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🎬</text></svg>",document.head.appendChild(t),he(()=>{const s=document.querySelector(".content-wrapper");s&&s.addEventListener("scroll",Y)})});const Z=()=>{const t=localStorage.getItem("userId"),s=localStorage.getItem("token");(!t||!s)&&(console.log("用户未登录，设置默认userId=1"),localStorage.setItem("userId","1"),localStorage.setItem("token","temp-token"))},ee=()=>{$.push("/pages/avatar/create")},te=()=>{$.push("/pages/voice/upload")},se=t=>{console.log("打开视频弹窗:",t),t.resultUrl&&(G.value=t,b.value=!0,setTimeout(()=>{const s=document.getElementById("videoPlayer");s&&(s.onerror=null,s.src=t.resultUrl,s.load(),s.play().catch(a=>{console.error("视频播放失败:",a)}))},100))},A=()=>{try{const t=document.getElementById("videoPlayer");t&&(t.onerror=null,t.onabort=null,t.removeAttribute("src"),t.load()),b.value=!1}catch(t){console.error("关闭视频时出错:",t),b.value=!1}},oe=async t=>{if(_.value===t.id&&v.value){v.value.pause(),v.value.currentTime=0,_.value=null;return}try{v.value&&(v.value.pause(),v.value.currentTime=0),v.value=new Audio(t.voiceUrl),_.value=t.id,await v.value.play(),v.value.onended=()=>{_.value=null}}catch(s){console.error("播放声音失败:",s),uni.showToast({title:"播放声音失败",icon:"none"}),_.value=null}},ae=t=>{try{const s=document.createElement("div");s.className="toast-message",s.textContent="准备下载...",s.style.position="fixed",s.style.top="50%",s.style.left="50%",s.style.transform="translate(-50%, -50%)",s.style.background="rgba(0, 0, 0, 0.7)",s.style.color="white",s.style.padding="10px 20px",s.style.borderRadius="5px",s.style.zIndex="9999",document.body.appendChild(s);const a=document.createElement("a");a.href=t.voiceUrl,a.download=`${t.fileName||"voice"}.wav`,document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(a.href),document.body.removeChild(a),document.body.removeChild(s);const e=document.createElement("div");e.className="toast-message",e.textContent="下载成功",e.style.position="fixed",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.background="rgba(0, 0, 0, 0.7)",e.style.color="white",e.style.padding="10px 20px",e.style.borderRadius="5px",e.style.zIndex="9999",document.body.appendChild(e),setTimeout(()=>{document.body.removeChild(e)},2e3)}catch(s){console.error("下载声音失败:",s);const a=document.createElement("div");a.className="toast-message",a.textContent="下载失败",a.style.position="fixed",a.style.top="50%",a.style.left="50%",a.style.transform="translate(-50%, -50%)",a.style.background="rgba(0, 0, 0, 0.7)",a.style.color="white",a.style.padding="10px 20px",a.style.borderRadius="5px",a.style.zIndex="9999",document.body.appendChild(a),setTimeout(()=>{document.body.removeChild(a)},2e3)}},le=t=>{if(!t)return"00:00";const s=Math.floor(t/60),a=Math.floor(t%60);return`${String(s).padStart(2,"0")}:${String(a).padStart(2,"0")}`},j=(t,s)=>{U.value=t,M.value=s,H.value=!0},L=()=>{H.value=!1},ne=async()=>{L(),S.value=!0;try{M.value==="avatar"?(await I.deleteWork(U.value,"avatar"),V()):M.value==="voice"&&(await I.deleteWork(U.value,"voice"),E()),S.value=!1,B.value="删除成功",C.value=!0,setTimeout(()=>{C.value=!1},2e3)}catch(t){console.error(`删除${M.value==="avatar"?"视频":"声音"}失败:`,t),S.value=!1,B.value="删除失败",C.value=!0,setTimeout(()=>{C.value=!1},2e3)}},ce=t=>{b.value&&(console.error("视频加载失败:",t),uni.showToast({title:"视频加载失败",icon:"none"}))},W=t=>{if(d.value==="voice")switch(parseInt(t)){case 1:return"status-processing";case 2:return"status-completed";case 3:return"status-failed";default:return""}switch(parseInt(t)){case 1:return"status-processing";case 2:return"status-processing";case 3:return"status-completed";case 4:case 5:return"status-failed";default:return""}},q=t=>{if(d.value==="voice")switch(parseInt(t)){case 1:return"处理中";case 2:return"已完成";case 3:return"失败";default:return"未知状态"}switch(parseInt(t)){case 1:return"审核中";case 2:return"处理中";case 3:return"已完成";case 4:case 5:return"失败";default:return"未知状态"}},ie=t=>{try{const s=document.createElement("div");s.className="toast-message",s.textContent="准备下载...",s.style.position="fixed",s.style.top="50%",s.style.left="50%",s.style.transform="translate(-50%, -50%)",s.style.background="rgba(0, 0, 0, 0.7)",s.style.color="white",s.style.padding="10px 20px",s.style.borderRadius="5px",s.style.zIndex="9999",document.body.appendChild(s);const a=document.createElement("a");a.href=t.resultUrl,a.download=`${t.name||"video"}.mp4`,document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(a.href),document.body.removeChild(a),document.body.removeChild(s);const e=document.createElement("div");e.className="toast-message",e.textContent="下载成功",e.style.position="fixed",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.background="rgba(0, 0, 0, 0.7)",e.style.color="white",e.style.padding="10px 20px",e.style.borderRadius="5px",e.style.zIndex="9999",document.body.appendChild(e),setTimeout(()=>{document.body.removeChild(e)},2e3)}catch(s){console.error("下载视频失败:",s);const a=document.createElement("div");a.className="toast-message",a.textContent="下载失败",a.style.position="fixed",a.style.top="50%",a.style.left="50%",a.style.transform="translate(-50%, -50%)",a.style.background="rgba(0, 0, 0, 0.7)",a.style.color="white",a.style.padding="10px 20px",a.style.borderRadius="5px",a.style.zIndex="9999",document.body.appendChild(a),setTimeout(()=>{document.body.removeChild(a)},2e3)}};pe(()=>{O()}),we(()=>Q.path,(t,s)=>{t!==s&&O()});const O=()=>{v.value&&(console.log("停止音频播放"),v.value.pause(),v.value.currentTime=0,_.value=null)},re=t=>{if(!t)return"/static/images/avatar-placeholder.png";try{return t.split("?")[0]+"?x-oss-process=video/snapshot,t_0"}catch(s){return console.error("生成缩略图URL失败:",s),"/static/images/avatar-placeholder.png"}},de=t=>{t.target.src.includes("avatar-placeholder.png")||(console.error("图片加载失败:",t.target.src),t.target.src="/static/images/avatar-placeholder.png")};return(t,s)=>{var a;return n(),l("view",ke,[be,o("view",Ce,[o("view",ze,[o("view",{class:z(["tab-item",{active:d.value==="avatar"}]),onClick:s[0]||(s[0]=e=>P("avatar"))},[Te,d.value==="avatar"?(n(),l("view",Me)):r("",!0)],2),o("view",{class:z(["tab-item",{active:d.value==="voice"}]),onClick:s[1]||(s[1]=e=>P("voice"))},[Se,d.value==="voice"?(n(),l("view",Ve)):r("",!0)],2)]),d.value==="avatar"?(n(),l("view",Ie,[o("view",He,[(n(!0),l(J,null,K(p.value,(e,u)=>(n(),l("view",{class:"asset-card",key:e.id},[o("view",Ue,[o("view",{class:"asset-preview",onClick:h=>e.resultUrl?se(e):null},[e.resultUrl||e.videoUrl?(n(),l("img",{key:0,src:re(e.resultUrl||e.videoUrl),class:"preview-image",loading:"lazy",onError:s[2]||(s[2]=h=>de(h))},null,40,Ee)):(n(),l("img",{key:1,src:e.coverUrl||e.previewUrl||"/static/images/avatar-placeholder.png",class:"preview-image"},null,8,Le)),Re,e.resultUrl?(n(),l("view",$e,De)):r("",!0),o("view",{class:z(["status-badge",W(e.status)])},k(q(e.status)),3)],8,Be),o("text",Fe,k(e.name),1),o("view",Ge,[parseInt(e.status)===3?(n(),l("view",{key:0,class:"action-btn download-btn",onClick:x(h=>ie(e),["stop"])},We,8,Pe)):r("",!0),o("view",{class:z(["action-btn delete-btn",{"full-width":parseInt(e.status)!==3}]),onClick:x(h=>j(e.id,"avatar"),["stop"])},Ke,10,qe)])])]))),128)),g.value&&d.value==="avatar"?(n(),l("view",Qe,Ze)):r("",!0),!f.value&&p.value.length>0&&d.value==="avatar"?(n(),l("view",et,st)):r("",!0),p.value.length===0&&!m.value&&d.value==="avatar"?(n(),l("view",ot,[at,o("text",{class:"empty-hint",onClick:ee},"点击上方按钮开始创建")])):r("",!0),m.value&&d.value==="avatar"?(n(),l("view",lt,it)):r("",!0)])])):r("",!0),d.value==="voice"?(n(),l("view",rt,[o("view",dt,[(n(!0),l(J,null,K(w.value,(e,u)=>(n(),l("view",{class:"voice-card",key:e.id},[o("view",vt,[o("view",{class:"play-button",onClick:x(h=>oe(e),["stop"])},[_.value!==e.id?(n(),l("svg",ht,wt)):(n(),l("svg",_t,mt))],8,ut),o("view",yt,[o("text",ft,k(e.fileName||e.name),1),o("view",xt,[e.durationSeconds?(n(),l("text",kt,k(le(e.durationSeconds)),1)):r("",!0),o("text",{class:z(["voice-status",W(e.status)])},k(q(e.status)),3)])]),o("view",bt,[parseInt(e.status)===2?(n(),l("view",{key:0,class:"voice-action-btn download-btn",onClick:x(h=>ae(e),["stop"])},Tt,8,Ct)):r("",!0),o("view",{class:"voice-action-btn delete-btn",onClick:x(h=>j(e.id,"voice"),["stop"])},Vt,8,Mt)])]),It]))),128)),g.value&&d.value==="voice"?(n(),l("view",Ht,Et)):r("",!0),!f.value&&w.value.length>0&&d.value==="voice"?(n(),l("view",Lt,$t)):r("",!0),w.value.length===0&&!m.value&&d.value==="voice"?(n(),l("view",Nt,[Dt,o("text",{class:"empty-hint",onClick:te},"点击上方按钮开始创建")])):r("",!0),m.value&&d.value==="voice"?(n(),l("view",Ft,At)):r("",!0)])])):r("",!0)]),_e(o("div",{class:"video-modal",onClick:A},[o("div",{class:"video-modal-content",onClick:s[3]||(s[3]=x(()=>{},["stop"]))},[o("div",jt,[o("div",Wt,k(((a=G.value)==null?void 0:a.name)||"视频预览"),1),o("div",{class:"close-button",onClick:A},Ot)]),o("div",Jt,[o("video",{id:"videoPlayer",controls:"",autoplay:"",class:"video-player",onError:ce},null,32)])])],512),[[ge,b.value]]),H.value?(n(),l("view",{key:0,class:"action-sheet",onClick:x(L,["self"])},[o("view",{class:"action-sheet-content"},[o("view",{class:"action-sheet-item delete",onClick:ne},Xt),o("view",{class:"action-sheet-item cancel",onClick:L},Zt)])])):r("",!0),C.value?(n(),l("view",es,[o("view",ts,k(B.value),1)])):r("",!0),S.value?(n(),l("view",ss,as)):r("",!0)])}}},rs=ve(ls,[["__scopeId","data-v-1ee5c016"]]);export{rs as default};
