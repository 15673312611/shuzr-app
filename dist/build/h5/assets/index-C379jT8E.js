import{_ as te,a as n,s as se,o as ae,x as oe,u as le,y as ie,c as l,q as E,b as t,w as ne,g as d,n as D,t as p,F as G,e as q,z as ce,j as g,p as re,k as de,l as i}from"./index-DDlqzt3H.js";import{a as N,v as R}from"./services-GkRl5Aq9.js";import"./request-CIZjav-Z.js";const a=y=>(re("data-v-dfff1ebd"),y=y(),de(),y),ve={class:"page-container"},ue=E('<view class="bg-elements" data-v-dfff1ebd><view class="bg-gradient" data-v-dfff1ebd></view><view class="bg-grid" data-v-dfff1ebd></view><view class="bg-circle circle1" data-v-dfff1ebd></view><view class="bg-circle circle2" data-v-dfff1ebd></view></view>',1),he={class:"content-wrapper"},fe={class:"tab-navigation"},we=a(()=>t("text",null,"我的数字人",-1)),_e={key:0,class:"tab-indicator"},pe=a(()=>t("text",null,"声音克隆",-1)),ge={key:0,class:"tab-indicator"},me={class:"create-button-container"},ye={class:"button-inner"},xe=a(()=>t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",width:"18",height:"18"},[t("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"})],-1)),ke={key:0,class:"tab-content"},be={class:"assets-grid"},Ce={class:"card-inner"},ze=["onClick"],Me=["src"],Ie=a(()=>t("view",{class:"preview-glow"},null,-1)),Se={class:"asset-info"},Ve={class:"asset-name"},Be=["onClick"],Ae=a(()=>t("text",null,"立即合成",-1)),Ue=[Ae],Te=["onClick"],$e=a(()=>t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",width:"18",height:"18"},[t("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"})],-1)),Ee=[$e],Fe={key:0,class:"empty-state"},He=E('<view class="empty-illustration" data-v-dfff1ebd><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="80" height="80" data-v-dfff1ebd><defs data-v-dfff1ebd><linearGradient id="avatarGradient" x1="0%" y1="0%" x2="100%" y2="100%" data-v-dfff1ebd><stop offset="0%" stop-color="#43B5FF" data-v-dfff1ebd></stop><stop offset="100%" stop-color="#10B981" data-v-dfff1ebd></stop></linearGradient></defs><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z" fill="url(#avatarGradient)" data-v-dfff1ebd></path></svg><view class="empty-glow" data-v-dfff1ebd></view></view><text class="empty-message" data-v-dfff1ebd>期待您的第一个数字人</text>',2),Le={key:1,class:"loading-state"},Pe=a(()=>t("view",{class:"loading-spinner"},null,-1)),De=a(()=>t("text",null,"加载中...",-1)),Ge=[Pe,De],qe={key:1,class:"tab-content"},Ne={class:"voice-list"},Re={class:"card-inner"},je=["onClick"],Je={key:0,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",width:"20",height:"20"},Ke=a(()=>t("path",{d:"M8 5v14l11-7z"},null,-1)),Oe=[Ke],Qe={key:1,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",width:"20",height:"20"},We=a(()=>t("path",{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z"},null,-1)),Xe=[We],Ye={class:"voice-info"},Ze={class:"voice-name"},et={class:"voice-meta"},tt={class:"voice-duration"},st=["onClick"],at=a(()=>t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",width:"18",height:"18"},[t("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"})],-1)),ot=[at],lt=a(()=>t("view",{class:"card-glow"},null,-1)),it={key:0,class:"empty-state"},nt=E('<view class="empty-illustration" data-v-dfff1ebd><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="80" height="80" data-v-dfff1ebd><defs data-v-dfff1ebd><linearGradient id="voiceGradient" x1="0%" y1="0%" x2="100%" y2="100%" data-v-dfff1ebd><stop offset="0%" stop-color="#6F4CFF" data-v-dfff1ebd></stop><stop offset="100%" stop-color="#2F70ED" data-v-dfff1ebd></stop></linearGradient></defs><path d="M12 15c1.66 0 2.99-1.34 2.99-3L15 6c0-1.66-1.34-3-3-3S9 4.34 9 6v6c0 1.66 1.34 3 3 3zm-1.2-9.1c0-.66.54-1.2 1.2-1.2s1.2.54 1.2 1.2l-.01 6.2c0 .66-.53 1.2-1.19 1.2s-1.2-.54-1.2-1.2V5.9zm6.5 6.1c0 3-2.54 5.1-5.3 5.1S6.7 15 6.7 12H5c0 3.41 2.72 6.23 6 6.72V22h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z" fill="url(#voiceGradient)" data-v-dfff1ebd></path></svg><view class="empty-glow" data-v-dfff1ebd></view></view><text class="empty-message" data-v-dfff1ebd>尚未创建声音克隆</text>',2),ct={key:1,class:"loading-state"},rt=a(()=>t("view",{class:"loading-spinner"},null,-1)),dt=a(()=>t("text",null,"加载中...",-1)),vt=[rt,dt],ut={class:"video-modal-header"},ht={class:"video-title"},ft=a(()=>t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",width:"24",height:"24"},[t("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})],-1)),wt=[ft],_t={class:"video-container"},pt={class:"video-modal-footer"},gt=a(()=>t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",width:"20",height:"20"},[t("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"})],-1)),mt=a(()=>t("div",null,"立即合成",-1)),yt=[gt,mt],xt=a(()=>t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",width:"20",height:"20"},[t("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"})],-1)),kt=a(()=>t("text",null,"删除",-1)),bt=[xt,kt],Ct=a(()=>t("text",null,"取消",-1)),zt=[Ct],Mt={key:1,class:"toast-wrapper"},It={class:"toast"},St={key:2,class:"loading-overlay"},Vt=a(()=>t("view",{class:"loading-content"},[t("view",{class:"loading-spinner"}),t("text",null,"删除中...")],-1)),Bt=[Vt],At={__name:"index",setup(y){const v=le(),x=oe(),r=n("avatar"),u=n(null),c=n(null),k=n(!1),b=n(!1),h=n([]),f=n([]),I=n(!1),S=n(null),V=n(null),m=n(!1),B=n(""),C=n(!1),_=n(!1),A=n(null),z=async()=>{k.value=!0;try{const e=await N.getMyList();console.log("数字人列表API返回数据:",e),e?Array.isArray(e)?h.value=e.map(s=>(!s.videoUrl&&s.id%2===0&&(s.videoUrl="https://assets.mixkit.co/videos/preview/mixkit-a-lighted-path-in-a-dark-forest-4479-large.mp4"),s)):e.data&&Array.isArray(e.data)?h.value=e.data.map(s=>(!s.videoUrl&&s.id%2===0&&(s.videoUrl="https://assets.mixkit.co/videos/preview/mixkit-a-lighted-path-in-a-dark-forest-4479-large.mp4"),s)):h.value=[]:h.value=[],console.log("处理后的数字人列表:",h.value)}catch(e){console.error("获取数字人列表失败:",e),uni.showToast({title:"获取数字人列表失败",icon:"none"}),h.value=[]}finally{k.value=!1}},U=async()=>{b.value=!0;try{const e=await R.getMyVoiceList();console.log("声音列表API返回数据:",e),e?Array.isArray(e)?f.value=e:e.data&&Array.isArray(e.data)?f.value=e.data:f.value=[]:f.value=[]}catch(e){console.error("获取声音列表失败:",e),uni.showToast({title:"获取声音列表失败",icon:"none"}),f.value=[]}finally{b.value=!1}},F=e=>{r.value=e,v.replace({path:x.path,query:{tab:e}},()=>{},{shallow:!0}),e==="avatar"?z():U(),T()};se(()=>x.query.tab,e=>{e&&(e==="avatar"||e==="voice")?(r.value=e,e==="avatar"?z():U()):(r.value="avatar",z())},{immediate:!0}),ae(()=>{j(),x.query.tab||v.replace({path:x.path,query:{tab:"avatar"}},()=>{},{shallow:!0});const e=document.createElement("link");e.rel="icon",e.href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🎬</text></svg>",document.head.appendChild(e),v.beforeEach((s,w,o)=>{T(),o()})}),ie(()=>{T()});const T=()=>{c.value&&(c.value.pause(),c.value.currentTime=0,c.value=null),u.value=null},j=()=>{const e=localStorage.getItem("userId"),s=localStorage.getItem("token");(!e||!s)&&(console.log("用户未登录，设置默认userId=1"),localStorage.setItem("userId","1"),localStorage.setItem("token","temp-token"))},J=()=>{v.push("/pages/avatar/upload")},K=()=>{v.push("/pages/voice/upload")},O=e=>{console.log("打开视频弹窗:",e),e.videoUrl?(A.value=e,_.value=!0,setTimeout(()=>{const s=document.getElementById("videoPlayer");s&&(s.onerror=null,s.src=e.videoUrl,s.load(),s.play().catch(w=>{console.error("视频播放失败:",w)}))},100)):v.push({path:"/pages/avatar/detail",query:{id:e.id}})},H=()=>{try{const e=document.getElementById("videoPlayer");e&&(e.onerror=null,e.onabort=null,e.removeAttribute("src"),e.load()),_.value=!1}catch(e){console.error("关闭视频时出错:",e),_.value=!1}},Q=async e=>{if(u.value===e.id&&c.value){c.value.pause(),c.value.currentTime=0,u.value=null;return}try{if(c.value&&(c.value.pause(),c.value.currentTime=0),!e.voiceUrl){console.error("没有找到声音URL:",e),uni.showToast({title:"声音文件不可用",icon:"none"});return}console.log("正在播放声音:",e.voiceUrl),c.value=new Audio(e.voiceUrl),u.value=e.id,await c.value.play(),c.value.onended=()=>{u.value=null},c.value.onerror=s=>{console.error("声音播放失败:",s),uni.showToast({title:"声音播放失败",icon:"none"}),u.value=null}}catch(s){console.error("播放声音失败:",s),uni.showToast({title:"播放声音失败",icon:"none"}),u.value=null}},W=e=>{if(!e)return"00:00";const s=Math.floor(e/60),w=Math.floor(e%60);return`${String(s).padStart(2,"0")}:${String(w).padStart(2,"0")}`},X=e=>{e==="avatar"?v.push("/pages/avatar/upload"):v.push("/pages/voice/create")},L=(e,s)=>{S.value=e,V.value=s,I.value=!0},$=()=>{I.value=!1},Y=async()=>{$(),C.value=!0;try{V.value==="avatar"?(await N.deleteAvatar(S.value),z()):(await R.deleteVoice(S.value),U()),C.value=!1,B.value="删除成功",m.value=!0,setTimeout(()=>{m.value=!1},2e3)}catch(e){console.error(`删除${V.value==="avatar"?"数字人":"声音"}失败:`,e),C.value=!1,B.value="删除失败",m.value=!0,setTimeout(()=>{m.value=!1},2e3)}},Z=e=>{_.value&&(console.error("视频加载失败:",e),uni.showToast({title:"视频加载失败",icon:"none"}))},P=e=>{e&&v.push({path:"/pages/avatar/clone",query:{videoUrl:e.videoUrl,avatarId:e.id,avatarName:e.name}})};return(e,s)=>{var w;return i(),l("view",ve,[ue,t("view",he,[t("view",fe,[t("view",{class:D(["tab-item",{active:r.value==="avatar"}]),onClick:s[0]||(s[0]=o=>F("avatar"))},[we,r.value==="avatar"?(i(),l("view",_e)):d("",!0)],2),t("view",{class:D(["tab-item",{active:r.value==="voice"}]),onClick:s[1]||(s[1]=o=>F("voice"))},[pe,r.value==="voice"?(i(),l("view",ge)):d("",!0)],2)]),t("view",me,[t("view",{class:"create-button",onClick:s[2]||(s[2]=o=>X(r.value))},[t("view",ye,[xe,t("text",null,"创建"+p(r.value==="avatar"?"数字人":"声音"),1)])])]),r.value==="avatar"?(i(),l("view",ke,[t("view",be,[(i(!0),l(G,null,q(h.value,(o,ee)=>(i(),l("view",{class:"asset-card",key:o.id},[t("view",Ce,[t("view",{class:"asset-preview",onClick:M=>O(o)},[t("img",{src:o.coverUrl||o.previewUrl||"/static/images/avatar-placeholder.png",mode:"aspectFill",class:"preview-image"},null,8,Me),Ie],8,ze),t("view",Se,[t("text",Ve,p(o.name),1),t("view",{class:"generate-btn",onClick:g(M=>P(o),["stop"])},Ue,8,Be)]),t("view",{class:"action-menu",onClick:g(M=>L(o.id,"avatar"),["stop"])},Ee,8,Te)])]))),128)),h.value.length===0&&!k.value?(i(),l("view",Fe,[He,t("text",{class:"empty-hint",onClick:J},"点击上方按钮开始创建")])):d("",!0),k.value?(i(),l("view",Le,Ge)):d("",!0)])])):d("",!0),r.value==="voice"?(i(),l("view",qe,[t("view",Ne,[(i(!0),l(G,null,q(f.value,(o,ee)=>(i(),l("view",{class:"voice-card",key:o.id},[t("view",Re,[t("view",{class:"play-button",onClick:g(M=>Q(o),["stop"])},[u.value!==o.id?(i(),l("svg",Je,Oe)):(i(),l("svg",Qe,Xe))],8,je),t("view",Ye,[t("text",Ze,p(o.name),1),t("view",et,[t("text",tt,p(W(o.durationSeconds)),1)])]),t("view",{class:"action-menu",onClick:g(M=>L(o.id,"voice"),["stop"])},ot,8,st)]),lt]))),128)),f.value.length===0&&!b.value?(i(),l("view",it,[nt,t("text",{class:"empty-hint",onClick:K},"点击上方按钮开始创建")])):d("",!0),b.value?(i(),l("view",ct,vt)):d("",!0)])])):d("",!0)]),ne(t("div",{class:"video-modal",onClick:H},[t("div",{class:"video-modal-content",onClick:s[4]||(s[4]=g(()=>{},["stop"]))},[t("div",ut,[t("div",ht,p(((w=A.value)==null?void 0:w.name)||"视频预览"),1),t("div",{class:"close-button",onClick:H},wt)]),t("div",_t,[t("video",{id:"videoPlayer",controls:"",autoplay:"",class:"video-player",onError:Z},null,32)]),t("div",pt,[t("div",{class:"generate-button",onClick:s[3]||(s[3]=o=>P(A.value))},yt)])])],512),[[ce,_.value]]),I.value?(i(),l("view",{key:0,class:"action-sheet",onClick:g($,["self"])},[t("view",{class:"action-sheet-content"},[t("view",{class:"action-sheet-item delete",onClick:Y},bt),t("view",{class:"action-sheet-item cancel",onClick:$},zt)])])):d("",!0),m.value?(i(),l("view",Mt,[t("view",It,p(B.value),1)])):d("",!0),C.value?(i(),l("view",St,Bt)):d("",!0)])}}},Et=te(At,[["__scopeId","data-v-dfff1ebd"]]);export{Et as default};
