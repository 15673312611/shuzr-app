import{_ as pe,a as l,D as I,y as fe,c as i,b as t,g as b,n as S,w as me,v as _e,q as E,t as g,F as ge,e as ye,G as O,i as ke,j as xe,p as Ce,k as be,u as Me,l as n}from"./index-DDlqzt3H.js";import{v as ze}from"./services-GkRl5Aq9.js";import"./request-CIZjav-Z.js";const r=L=>(Ce("data-v-664f81ee"),L=L(),be(),L),Be={class:"page-container"},Se=r(()=>t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",width:"24",height:"24"},[t("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"})],-1)),Ae=[Se],Te=r(()=>t("view",{class:"page-title"},"声音克隆",-1)),Ue=r(()=>t("view",{class:"right-actions"},null,-1)),$e={class:"app-content-wrapper"},Fe={class:"app-content"},Le={class:"tabs"},Re={class:"name-input-container top-name-input"},Ve=r(()=>t("view",{class:"input-label"},"声音名称",-1)),De={key:0,class:"tab-content"},Pe={class:"record-status"},Ie={class:"status-text"},Ee={key:0,class:"time-counter"},je={class:"waveform-container"},He={key:0,class:"waveform"},Ne={key:1,class:"empty-waveform"},We=r(()=>t("view",{class:"empty-text"},"录音开始后将显示波形图",-1)),Oe=[We],qe={key:2,class:"custom-audio-player"},Ge={key:0,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",width:"24",height:"24"},Ke=r(()=>t("path",{d:"M8 5v14l11-7z"},null,-1)),Xe=[Ke],Je={key:1,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",width:"24",height:"24"},Qe=r(()=>t("path",{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z"},null,-1)),Ye=[Qe],Ze={class:"progress-container"},et={class:"time-display"},tt=["src"],at={class:"record-controls"},st={class:"record-btn-inner"},ot={key:0,class:"record-icon"},lt={key:1,class:"stop-icon"},it={class:"record-label"},nt=E('<view class="record-tips" data-v-664f81ee><view class="tip-title-icon" data-v-664f81ee><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24" data-v-664f81ee><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm0-4h-2V7h2v8z" data-v-664f81ee></path></svg></view><view class="tip-title" data-v-664f81ee>录音提示</view><view class="tip-content" data-v-664f81ee><view class="tip-item" data-v-664f81ee>请确保环境安静，避免背景噪音</view><view class="tip-item" data-v-664f81ee>请以正常语速和音量说话</view><view class="tip-item" data-v-664f81ee>请录制至少15秒以上的音频</view></view></view>',1),ct={key:1,class:"tab-content upload-tab-content"},vt={key:0,class:"uploaded-content"},rt={class:"file-info"},ut={class:"file-size"},dt={class:"custom-audio-player"},ht={key:0,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",width:"24",height:"24"},wt=r(()=>t("path",{d:"M8 5v14l11-7z"},null,-1)),pt=[wt],ft={key:1,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",width:"24",height:"24"},mt=r(()=>t("path",{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z"},null,-1)),_t=[mt],gt={class:"progress-container"},yt={class:"time-display"},kt=["src"],xt=r(()=>t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",width:"20",height:"20"},[t("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})],-1)),Ct=r(()=>t("text",null,"删除",-1)),bt=[xt,Ct],Mt=E('<view class="upload-inner" data-v-664f81ee><view class="upload-icon" data-v-664f81ee><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="48" height="48" data-v-664f81ee><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z" data-v-664f81ee></path></svg></view><view class="upload-text" data-v-664f81ee>点击上传音频文件</view><view class="upload-desc" data-v-664f81ee>支持MP3、WAV格式，大小不超过50MB</view></view>',1),zt=[Mt],Bt=E('<view class="upload-tips" data-v-664f81ee><view class="tip-title-icon" data-v-664f81ee><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24" data-v-664f81ee><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm0-4h-2V7h2v8z" data-v-664f81ee></path></svg></view><view class="tip-title" data-v-664f81ee>上传提示</view><view class="tip-content" data-v-664f81ee><view class="tip-item" data-v-664f81ee>请上传清晰的人声音频</view><view class="tip-item" data-v-664f81ee>避免背景音乐和噪音</view><view class="tip-item" data-v-664f81ee>建议15-60秒，效果最佳</view><view class="tip-item" data-v-664f81ee>支持MP3、WAV格式，小于50MB</view></view></view>',1),St={class:"agreement-section"},At={key:0,class:"checkbox-inner"},Tt={class:"agreement-text"},Ut={class:"modal-content"},$t={class:"modal-header"},Ft=r(()=>t("div",{class:"modal-title"},"使用者承诺须知",-1)),Lt=r(()=>t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",width:"16",height:"16"},[t("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})],-1)),Rt=[Lt],Vt=E('<div class="agreement-content" data-v-664f81ee><div class="agreement-section" data-v-664f81ee><div class="agreement-section-title" data-v-664f81ee>1. 服务描述</div><p data-v-664f81ee>声音克隆服务允许用户上传音频样本，并利用AI技术创建模仿用户声音特征的合成语音。用户理解并接受，该技术仅用于合法、正当的个人或商业用途。</p></div><div class="agreement-section" data-v-664f81ee><div class="agreement-section-title" data-v-664f81ee>2. 用户授权与隐私</div><p data-v-664f81ee>用户通过上传音频样本，授权我们处理该音频数据以创建声音克隆模型。我们将按照隐私政策保护用户数据，不会未经授权将用户声音用于其他商业目的。</p></div><div class="agreement-section" data-v-664f81ee><div class="agreement-section-title" data-v-664f81ee>3. 用户责任</div><p data-v-664f81ee>用户承诺：</p><p data-v-664f81ee>- 不使用声音克隆技术从事任何违法活动或欺诈行为</p><p data-v-664f81ee>- 不侵犯他人隐私或未经授权克隆他人声音</p><p data-v-664f81ee>- 不利用声音克隆传播虚假信息、仇恨言论或有害内容</p><p data-v-664f81ee>- 在使用合成声音时，适当披露其AI合成性质</p></div><div class="agreement-section" data-v-664f81ee><div class="agreement-section-title" data-v-664f81ee>4. 知识产权</div><p data-v-664f81ee>用户保留其原始音频样本的权利。通过我们的服务生成的合成语音，其使用权归用户所有，但技术和服务的知识产权归我们所有。</p></div><div class="agreement-section" data-v-664f81ee><div class="agreement-section-title" data-v-664f81ee>5. 免责声明</div><p data-v-664f81ee>我们不对用户利用声音克隆技术可能造成的任何损失、损害或法律后果承担责任。服务按&quot;现状&quot;提供，不提供任何明示或暗示的保证。</p></div><div class="agreement-section" data-v-664f81ee><div class="agreement-section-title" data-v-664f81ee>6. 协议修改</div><p data-v-664f81ee>我们保留随时修改本协议的权利。修改后的协议将在网站上公布，继续使用我们的服务即表示接受修改后的条款。</p></div><div class="agreement-section" data-v-664f81ee><div class="agreement-section-title" data-v-664f81ee>7. 适用法律</div><p data-v-664f81ee>本协议受中华人民共和国法律管辖，任何争议应通过友好协商解决。</p></div></div>',1),Dt={class:"submit-button-container"},Pt={key:0,class:"toast-icon"},It=r(()=>t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",width:"24",height:"24"},[t("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"})],-1)),Et=[It],jt={key:1,class:"toast-icon"},Ht=r(()=>t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",width:"24",height:"24"},[t("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})],-1)),Nt=[Ht],Wt={class:"toast-message"},Ot=4096,qt={__name:"upload",setup(L){const q=Me(),v=l("record"),h=l(null);l("");const M=l(null),z=l(!1),A=l(""),T=l(!1),w=l(""),_=l("");I(()=>v.value==="record"?w.value:_.value);const p=l(!1),y=l("准备录音"),B=l(0);l(null),l([]);const R=l(null),j=l(Array(30).fill(5)),c=l(null),f=l(!1),U=l(0),$=l(0),k=l(0),G=e=>{const a=Math.floor(e/60),s=Math.floor(e%60);return`${a.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`},K=I(()=>G($.value)),X=I(()=>G(k.value)),J=()=>{try{if(!c.value)return;if(f.value)c.value.pause();else{c.value.volume=.75;const e=c.value.play();e!==void 0&&e.catch(a=>{console.error("播放错误:",a),f.value=!1})}f.value=!f.value}catch(e){console.error("音频控制错误:",e),f.value=!1}},Q=()=>{try{if(!c.value)return;$.value=c.value.currentTime,k.value>0&&(U.value=$.value/k.value*100)}catch(e){console.error("更新时间错误:",e)}},Y=()=>{try{if(!c.value)return;k.value=c.value.duration||0}catch(e){console.error("加载音频错误:",e),k.value=0}},Z=()=>{f.value=!1,U.value=0,$.value=0},ee=I(()=>(v.value==="record"&&w.value||v.value==="upload"&&h.value)&&z.value&&A.value.trim()!==""),le=e=>{const a=Math.floor(e/60),s=e%60;return`${a.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`},ie=e=>e<1024?e+" B":e<1024*1024?(e/1024).toFixed(2)+" KB":(e/(1024*1024)).toFixed(2)+" MB",ne=()=>{q.back()},ce=async()=>{p.value?H():ve()},x=l(null),te=l(null),d=l(null),C=l([]);l(null);const V=l(!1),ve=async()=>{try{C.value=[];const e=await navigator.mediaDevices.getUserMedia({audio:{channelCount:1,sampleRate:44100,echoCancellation:!0,noiseSuppression:!0}});x.value=new(window.AudioContext||window.webkitAudioContext)({sampleRate:44100}),te.value=x.value.createMediaStreamSource(e),d.value=x.value.createScriptProcessor(Ot,1,1),te.value.connect(d.value),d.value.connect(x.value.destination),d.value.stream=e,V.value=!0,p.value=!0,y.value="正在录音...",B.value=0,d.value.onaudioprocess=a=>{if(!V.value)return;const s=a.inputBuffer.getChannelData(0),o=new Float32Array(s);C.value.push(new Float32Array(o))},R.value=setInterval(()=>{B.value++,j.value=j.value.map(()=>5+Math.random()*30)},1e3),console.log("录音已启动，采样率:",x.value.sampleRate)}catch(e){console.error("无法启动录音:",e),y.value="录音失败",m("无法获取麦克风权限，请确认您已授权此网站使用您的麦克风")}},H=()=>{if(V.value){V.value=!1,p.value=!1,clearInterval(R.value),y.value="处理录音数据...";try{if(d.value&&(d.value.disconnect(),d.value.onaudioprocess=null,d.value.stream&&d.value.stream.getTracks().forEach(u=>u.stop())),!C.value.length){y.value="录音失败，未检测到音频",m("录音失败，未检测到有效音频数据");return}const e=C.value.reduce((u,F)=>u+F.length,0),a=new Float32Array(e);let s=0;for(let u=0;u<C.value.length;u++)a.set(C.value[u],s),s+=C.value[u].length;console.log(`合并了${C.value.length}块音频数据，总长度:${e}`);const o=re(a,x.value.sampleRate);if(M.value=new Blob([o],{type:"audio/wav"}),console.log(`生成WAV文件，大小:${M.value.size}字节，时长:${B.value}秒`),M.value.size<1e3||B.value<1){y.value="录音太短或无效",m("录音太短或无效，请重新录制");return}w.value=URL.createObjectURL(M.value),y.value="录音已完成",console.log("录音处理完成，可以预览")}catch(e){console.error("处理录音时出错:",e),y.value="录音处理失败",m("处理录音数据时出错")}}},re=(e,a)=>{const s=new ArrayBuffer(44+e.length*2),o=new DataView(s);return D(o,0,"RIFF"),o.setUint32(4,36+e.length*2,!0),D(o,8,"WAVE"),D(o,12,"fmt "),o.setUint32(16,16,!0),o.setUint16(20,1,!0),o.setUint16(22,1,!0),o.setUint32(24,a,!0),o.setUint32(28,a*2,!0),o.setUint16(32,2,!0),o.setUint16(34,16,!0),D(o,36,"data"),o.setUint32(40,e.length*2,!0),ue(o,44,e),s},D=(e,a,s)=>{for(let o=0;o<s.length;o++)e.setUint8(a+o,s.charCodeAt(o))},ue=(e,a,s)=>{for(let o=0;o<s.length;o++,a+=2){const u=Math.max(-1,Math.min(1,s[o]));e.setInt16(a,u<0?u*32768:u*32767,!0)}},de=()=>{const e=document.createElement("input");e.type="file",e.accept="audio/mp3,audio/wav",e.onchange=a=>{const s=a.target.files[0];if(s){if(s.size>50*1024*1024){alert("音频文件不能超过50MB");return}if(!["audio/mp3","audio/wav","audio/mpeg"].includes(s.type)){alert("请上传MP3或WAV格式的音频文件");return}h.value=s,_.value=URL.createObjectURL(s)}},e.click()},he=()=>{h.value=null,v.value==="upload"&&_.value&&(URL.revokeObjectURL(_.value),_.value="")},N=l(!1),ae=l(""),P=l("error"),W=l(null),m=(e,a="error")=>{W.value&&clearTimeout(W.value),ae.value=e,P.value=a,N.value=!0,W.value=setTimeout(()=>{N.value=!1},3e3)},we=async()=>{if(!ee.value){v.value==="record"&&!w.value||v.value==="upload"&&!h.value?m("请录制或上传音频"):A.value.trim()?z.value||m("请阅读并同意使用者承诺须知"):m("请输入声音名称");return}try{const e=new FormData;if(e.append("name",A.value),v.value==="record"&&M.value){const s=`recording_${Date.now()}.wav`,o=new File([M.value],s,{type:"audio/wav",lastModified:Date.now()});console.log(`准备提交录音文件: ${s}, 大小: ${o.size} bytes, 类型: ${o.type}, 时长: ${B.value}秒`),e.append("file",o)}else v.value==="upload"&&h.value&&(console.log(`准备提交上传文件: ${h.value.name}, 大小: ${h.value.size} bytes, 类型: ${h.value.type}`),e.append("file",h.value));if(m("正在提交...","info"),!await ze.uploadSample(e))throw new Error("服务器未返回任何数据");m("提交成功","success"),setTimeout(()=>{q.replace({path:"/pages/asset/index",query:{tab:"voice"},force:!0})},1500)}catch(e){console.error("提交失败:",e);let a="提交失败，请重试";e.response&&e.response.data?a=e.response.data.message||a:e.message&&(a=e.message),m(a)}},se=e=>{try{if(!c.value||!k.value)return;const s=e.currentTarget.getBoundingClientRect(),u=Math.max(0,Math.min(e.clientX-s.left,s.width))/s.width,F=Math.max(0,Math.min(u,1));c.value.currentTime=F*k.value,U.value=F*100,$.value=F*k.value}catch(a){console.error("跳转播放位置错误:",a)}},oe=e=>{v.value==="record"&&p.value&&e!=="record"&&H(),f.value&&c.value&&(c.value.pause(),f.value=!1),v.value=e};return fe(()=>{p.value&&H(),x.value&&x.value.close().catch(console.error),d.value&&d.value.disconnect(),w.value&&URL.revokeObjectURL(w.value),_.value&&URL.revokeObjectURL(_.value),R.value&&clearInterval(R.value),c.value&&!c.value.paused&&(c.value.pause(),c.value.currentTime=0)}),(e,a)=>(n(),i("view",Be,[t("view",{class:"header"},[t("view",{class:"back-button",onClick:ne},Ae),Te,Ue]),t("div",$e,[t("div",Fe,[t("view",Le,[t("view",{class:S(["tab-item",{active:v.value==="record"}]),onClick:a[0]||(a[0]=s=>oe("record"))}," 录制音频 ",2),t("view",{class:S(["tab-item",{active:v.value==="upload"}]),onClick:a[1]||(a[1]=s=>oe("upload"))}," 上传音频 ",2)]),t("view",Re,[Ve,me(t("input",{type:"text","onUpdate:modelValue":a[2]||(a[2]=s=>A.value=s),class:"name-input",placeholder:"请输入声音名称（必填）"},null,512),[[_e,A.value]])]),v.value==="record"?(n(),i("view",De,[t("view",Pe,[t("view",Ie,g(y.value),1),p.value||v.value==="record"&&w.value?(n(),i("view",Ee,g(le(B.value)),1)):b("",!0)]),t("view",je,[p.value?(n(),i("view",He,[(n(!0),i(ge,null,ye(j.value,(s,o)=>(n(),i("view",{class:"wave-bar",key:o,style:O({height:s+"px"})},null,4))),128))])):!w.value||v.value!=="record"?(n(),i("view",Ne,Oe)):v.value==="record"&&w.value?(n(),i("view",qe,[t("view",{class:"play-button",onClick:J},[f.value?(n(),i("svg",Je,Ye)):(n(),i("svg",Ge,Xe))]),t("view",Ze,[t("view",{class:"progress-bar",onClick:se},[t("view",{class:"progress-fill",style:O({width:`${U.value}%`})},null,4)]),t("view",et,g(K.value)+" / "+g(X.value),1)]),t("audio",{ref_key:"audioElement",ref:c,src:w.value,class:"hidden-audio",onTimeupdate:Q,onLoadedmetadata:Y,onEnded:Z},null,40,tt)])):b("",!0)]),t("view",at,[t("view",{class:S(["record-btn",{recording:p.value}]),onClick:ce},[t("view",st,[p.value?(n(),i("view",lt)):(n(),i("view",ot))])],2),t("view",it,g(p.value?"停止录音":"开始录音"),1)]),nt])):b("",!0),v.value==="upload"?(n(),i("view",ct,[h.value&&_.value?(n(),i("view",vt,[t("view",rt,[t("view",ut,g(ie(h.value.size)),1)]),t("view",dt,[t("view",{class:"play-button",onClick:J},[f.value?(n(),i("svg",ft,_t)):(n(),i("svg",ht,pt))]),t("view",gt,[t("view",{class:"progress-bar",onClick:se},[t("view",{class:"progress-fill",style:O({width:`${U.value}%`})},null,4)]),t("view",yt,g(K.value)+" / "+g(X.value),1)]),t("audio",{ref_key:"audioElement",ref:c,src:_.value,class:"hidden-audio",onTimeupdate:Q,onLoadedmetadata:Y,onEnded:Z},null,40,kt)]),t("view",{class:"file-actions"},[t("view",{class:"file-action-btn delete",onClick:he},bt)])])):(n(),i("view",{key:1,class:"upload-container",onClick:de},zt)),Bt])):b("",!0),t("view",St,[t("view",{class:S(["agreement-checkbox",{checked:z.value}]),onClick:a[3]||(a[3]=s=>z.value=!z.value)},[z.value?(n(),i("view",At)):b("",!0)],2),t("text",Tt,[ke("同意并且确认"),t("span",{class:"agreement-link",onClick:a[4]||(a[4]=s=>T.value=!0)},"《使用者承诺须知》")])]),T.value?(n(),i("div",{key:2,class:"agreement-modal",onClick:a[7]||(a[7]=xe(s=>T.value=!1,["self"]))},[t("div",Ut,[t("div",$t,[Ft,t("div",{class:"close-btn",onClick:a[5]||(a[5]=s=>T.value=!1)},Rt)]),Vt,t("button",{class:"confirm-btn",onClick:a[6]||(a[6]=s=>T.value=!1)},"我已阅读并同意")])])):b("",!0),t("view",Dt,[t("view",{class:S(["submit-button",{disabled:!ee.value}]),onClick:we}," 确认提交 ",2)])])]),N.value?(n(),i("div",{key:0,class:S(["custom-toast",{error:P.value==="error",success:P.value==="success"}])},[P.value==="error"?(n(),i("div",Pt,Et)):(n(),i("div",jt,Nt)),t("div",Wt,g(ae.value),1)],2)):b("",!0)]))}},Jt=pe(qt,[["__scopeId","data-v-664f81ee"]]);export{Jt as default};
