import{_ as U,r as P,a as d,o as $,c as l,b as e,d as b,F as M,e as N,f as j,w as p,g as h,v as f,h as C,n as g,i as B,j as E,p as F,k as R,u as D,l as a}from"./index-DDlqzt3H.js";import{u as L}from"./services-GkRl5Aq9.js";import{U as q}from"./UserAgreementModal-BtgWJLAP.js";import"./request-CIZjav-Z.js";const o=u=>(F("data-v-6b2e4366"),u=u(),R(),u),G={class:"register-container"},H={class:"animated-bg"},J=o(()=>e("view",{class:"glow-circle circle-1"},null,-1)),K=o(()=>e("view",{class:"glow-circle circle-2"},null,-1)),O=o(()=>e("view",{class:"glow-circle circle-3"},null,-1)),Q={class:"floating-particles"},W={class:"content-wrapper"},X={class:"title-area"},Y={class:"logo-container"},Z=o(()=>e("view",{class:"logo-glow"},null,-1)),ee=o(()=>e("text",{class:"title"},"数字人平台",-1)),te=o(()=>e("text",{class:"subtitle"},"创建您的新账户",-1)),se={class:"form-area"},oe=o(()=>e("view",{class:"form-header"},[e("text",{class:"form-title"},"注册"),e("text",{class:"form-subtitle"})],-1)),ie={class:"input-item"},ne=o(()=>e("view",{class:"input-icon"},[e("text",{class:"iconfont icon-account",style:{color:"#3ef7c8","font-size":"22px"}})],-1)),le=o(()=>e("text",{class:"iconfont icon-close",style:{color:"#7A7A7A","font-size":"18px"}},null,-1)),ae=[le],ce={class:"input-item"},re=o(()=>e("view",{class:"input-icon"},[e("text",{class:"iconfont icon-email",style:{color:"#3ef7c8","font-size":"22px"}})],-1)),de=o(()=>e("text",{class:"iconfont icon-close",style:{color:"#7A7A7A","font-size":"18px"}},null,-1)),pe=[de],ue={class:"input-item captcha-item"},me=o(()=>e("view",{class:"input-icon"},[e("text",{class:"iconfont icon-shield",style:{color:"#3ef7c8","font-size":"22px"}})],-1)),he=["src"],ve={class:"input-item"},we=o(()=>e("view",{class:"input-icon"},[e("text",{class:"iconfont icon-lock",style:{color:"#3ef7c8","font-size":"22px"}})],-1)),_e=["type"],fe={class:"input-item"},ge=o(()=>e("view",{class:"input-icon"},[e("text",{class:"iconfont icon-lock-fill",style:{color:"#3ef7c8","font-size":"22px"}})],-1)),xe=["type"],ye=o(()=>e("text",{class:"iconfont icon-close",style:{color:"#7A7A7A","font-size":"18px"}},null,-1)),ke=[ye],be={class:"agreement-row"},Ce={key:0,class:"iconfont icon-check",style:{color:"#000","font-size":"12px"}},Ie={style:{color:"#bbbbbb","margin-left":"8px"}},Ae=o(()=>e("view",{class:"spacer-element"},null,-1)),Te={class:"btn-wrapper"},ze={key:0},Ve={key:1,class:"loading-spinner"},Se=o(()=>e("view",{class:"btn-glow"},null,-1)),Ue=o(()=>e("text",null,"已有账号?",-1)),Pe={__name:"index",setup(u){const x=D(),t=P({username:"",email:"",password:"",confirmPassword:"",captcha:"",captchaId:"",inviteCode:""}),c=d(!1),r=d(!1),m=d(!1),y=d(""),v=d(!1),I=()=>{c.value=!c.value},A=()=>{r.value=!r.value},T=i=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i),k=async()=>{try{const s=await(await fetch("/api/captcha/generate")).json();s.image?(y.value="data:image/jpeg;base64,"+s.image,t.captchaId=s.captchaId):console.error("获取验证码失败")}catch(i){console.error("获取验证码失败:",i)}},w=()=>{k()},z=async()=>{try{if(!t.username||!t.email||!t.password||!t.confirmPassword||!t.captcha){uni.showToast({title:"请完整填写注册信息",icon:"none"});return}if(!t.captcha){uni.showToast({title:"请输入验证码",icon:"none"}),w();return}if(!T(t.email)){uni.showToast({title:"请输入有效的邮箱地址",icon:"none"});return}if(t.password.length<6){uni.showToast({title:"密码长度至少为6位",icon:"none"});return}if(t.password!==t.confirmPassword){uni.showToast({title:"两次输入的密码不一致",icon:"none"});return}if(!r.value){uni.showToast({title:"请阅读并同意用户协议",icon:"none"});return}m.value=!0;const i={username:t.username,email:t.email,password:t.password,captcha:t.captcha,captchaId:t.captchaId};t.inviteCode&&(i.inviteCode=t.inviteCode);const s=await L.register(i);if(console.log("注册响应:",s),s&&s.token){localStorage.setItem("token",s.token),localStorage.setItem("userId",s.userId||"1"),localStorage.removeItem("inviteCode");const _=localStorage.getItem("redirectUrl")||"/pages/asset/index";localStorage.removeItem("redirectUrl"),S(_)}else throw new Error("注册失败，请重试")}catch(i){console.error("注册失败:",i),uni.showToast({title:i.message||"注册失败，请重试",icon:"none"}),w()}finally{m.value=!1}},V=()=>{x.push("/pages/login/index")},S=i=>{uni.showToast({title:"注册成功",icon:"success"}),setTimeout(()=>{x.push("/pages/index/index")},1e3)};return $(()=>{k();const i=localStorage.getItem("inviteCode");i&&(console.log("使用存储的邀请码:",i),t.inviteCode=i)}),(i,s)=>{const _=j("u-avatar");return a(),l("view",G,[e("view",H,[J,K,O,e("view",Q,[(a(),l(M,null,N(20,n=>e("view",{class:"particle",key:n})),64))])]),e("view",W,[e("view",X,[e("view",Y,[Z,b(_,{size:"80",icon:"account-fill",fontSize:"40",color:"#000",bgColor:"#3ef7c8"})]),ee,te]),e("view",se,[oe,e("view",ie,[ne,p(e("input",{type:"text","onUpdate:modelValue":s[0]||(s[0]=n=>t.username=n),placeholder:"请输入用户名","placeholder-style":"color: #666666",class:"input-field"},null,512),[[f,t.username]]),t.username?(a(),l("view",{key:0,class:"input-clear",onClick:s[1]||(s[1]=n=>t.username="")},ae)):h("",!0)]),e("view",ce,[re,p(e("input",{type:"text","onUpdate:modelValue":s[2]||(s[2]=n=>t.email=n),placeholder:"请输入邮箱","placeholder-style":"color: #666666",class:"input-field"},null,512),[[f,t.email]]),t.email?(a(),l("view",{key:0,class:"input-clear",onClick:s[3]||(s[3]=n=>t.email="")},pe)):h("",!0)]),e("view",ue,[me,p(e("input",{type:"text","onUpdate:modelValue":s[4]||(s[4]=n=>t.captcha=n),placeholder:"验证码","placeholder-style":"color: #666666",class:"input-field captcha-input",maxlength:"4"},null,512),[[f,t.captcha]]),e("view",{class:"captcha-image",onClick:w},[e("img",{src:y.value,mode:"aspectFit"},null,8,he)])]),e("view",ve,[we,p(e("input",{type:c.value?"text":"password","onUpdate:modelValue":s[5]||(s[5]=n=>t.password=n),placeholder:"请输入密码","placeholder-style":"color: #666666",class:"input-field"},null,8,_e),[[C,t.password]]),e("view",{class:"input-clear",onClick:I},[e("text",{class:g(["iconfont",c.value?"icon-eye-fill":"icon-eye-off"]),style:{color:"#7A7A7A","font-size":"18px"}},null,2)])]),e("view",fe,[ge,p(e("input",{type:c.value?"text":"password","onUpdate:modelValue":s[6]||(s[6]=n=>t.confirmPassword=n),placeholder:"请确认密码","placeholder-style":"color: #666666",class:"input-field"},null,8,xe),[[C,t.confirmPassword]]),t.confirmPassword?(a(),l("view",{key:0,class:"input-clear",onClick:s[7]||(s[7]=n=>t.confirmPassword="")},ke)):h("",!0)]),e("view",be,[e("view",{class:"checkbox-container",onClick:A},[e("view",{class:g(["checkbox",{"checkbox-active":r.value}])},[r.value?(a(),l("text",Ce)):h("",!0)],2),e("text",Ie,[B(" 我已阅读并同意 "),e("text",{class:"agreement-link",onClick:s[8]||(s[8]=E(n=>v.value=!0,["stop"]))},"《用户协议》")])])]),Ae,e("view",Te,[e("button",{class:g(["register-btn",{"register-btn-loading":m.value}]),onClick:z},[m.value?(a(),l("view",Ve)):(a(),l("text",ze,"创建账号"))],2),Se]),e("view",{class:"login-link"},[Ue,e("text",{class:"link",onClick:V},"立即登录")])])]),b(q,{visible:v.value,onClose:s[9]||(s[9]=n=>v.value=!1)},null,8,["visible"])])}}},Be=U(Pe,[["__scopeId","data-v-6b2e4366"]]);export{Be as default};
