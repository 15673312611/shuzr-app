import{_ as T,a as n,o as $,c as l,b as e,q as I,g as b,d as N,C as S,f as E,F as H,e as q,p as F,k as G,u as R,l as i,n as u,t as k,j}from"./index-DDlqzt3H.js";import{s as D}from"./request-CIZjav-Z.js";const s=d=>(F("data-v-82dd3cea"),d=d(),G(),d),P={class:"container"},A=s(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",width:"20",height:"20"},[e("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"})],-1)),J=[A],K=s(()=>e("view",{class:"header-title"},[e("text",null,"形象市场")],-1)),O=s(()=>e("view",{class:"placeholder-space"},null,-1)),Q=I('<view class="banner-section" data-v-82dd3cea><view class="banner-content" data-v-82dd3cea><view class="banner-text" data-v-82dd3cea><text class="banner-title" data-v-82dd3cea>形象市场</text><text class="banner-subtitle" data-v-82dd3cea>选择您喜欢的形象，快速生成专业视频</text><view class="banner-features" data-v-82dd3cea><view class="feature-item" data-v-82dd3cea><view class="feature-icon" data-v-82dd3cea><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" data-v-82dd3cea><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z" fill="currentColor" data-v-82dd3cea></path></svg></view><text class="feature-text" data-v-82dd3cea>精选形象</text></view><view class="feature-item" data-v-82dd3cea><view class="feature-icon" data-v-82dd3cea><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" data-v-82dd3cea><path d="M15 1H9v2h6V1zm-4 13h2V8h-2v6zm8.03-6.61l1.42-1.42c-.43-.51-.9-.99-1.41-1.41l-1.42 1.42C16.07 4.74 14.12 4 12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9 9-4.03 9-9c0-2.12-.74-4.07-1.97-5.61zM12 20c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z" fill="currentColor" data-v-82dd3cea></path></svg></view><text class="feature-text" data-v-82dd3cea>快速生成</text></view></view></view><view class="banner-graphic" data-v-82dd3cea><view class="graphic-element" data-v-82dd3cea><view class="avatar-element-1" data-v-82dd3cea></view><view class="avatar-element-2" data-v-82dd3cea></view></view></view></view></view>',1),W={class:"categories-section"},X=s(()=>e("view",{class:"section-header"},[e("text",{class:"section-title"},"选择分类")],-1)),Y={class:"categories-list"},Z=s(()=>e("view",{class:"category-icon"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"18",height:"18"},[e("path",{d:"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z",fill:"currentColor"})])],-1)),ee=s(()=>e("text",{class:"category-name"},"全部",-1)),te=[Z,ee],se=s(()=>e("view",{class:"category-icon"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"18",height:"18"},[e("path",{d:"M10 14c-1.1 0-2-.9-2-2V5c0-1.1.9-2 2-2s2 .9 2 2v7c0 1.1-.9 2-2 2zm4-1v-3c0-1.66-1.34-3-3-3h-2c-1.66 0-3 1.34-3 3v3c0 1.1-.9 2-2 2v2h12v-2c-1.1 0-2-.9-2-2z",fill:"currentColor"})])],-1)),ae=s(()=>e("text",{class:"category-name"},"男生",-1)),oe=[se,ae],ce=s(()=>e("view",{class:"category-icon"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"18",height:"18"},[e("path",{d:"M12 6c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2zm7 7c-.53 0-1.04.21-1.41.59C17.21 14.96 17 15.47 17 16v4.34l-3-3V13c0-.55-.45-1-1-1h-4c-.55 0-1 .45-1 1v8.34l-3-3V16c0-.53-.21-1.04-.59-1.41C3.04 14.21 2.53 14 2 14v6h20v-6c-.53 0-1.04.21-1.41.59-.38.37-.59.88-.59 1.41z",fill:"currentColor"})])],-1)),le=s(()=>e("text",{class:"category-name"},"女生",-1)),ie=[ce,le],ne={class:"templates-section"},re={key:0,class:"loading-state"},de=s(()=>e("view",{class:"loading-spinner"},null,-1)),ve=s(()=>e("view",{class:"loading-text"},"正在加载形象...",-1)),we=[de,ve],he={key:1,class:"empty-state"},_e=s(()=>e("view",{class:"empty-icon"},"🔍",-1)),ue=s(()=>e("view",{class:"empty-text"},"暂无形象",-1)),ge=s(()=>e("view",{class:"empty-desc"},"尝试选择其他分类或性别筛选",-1)),pe=[_e,ue,ge],me={key:2,class:"templates-grid"},xe=["onClick"],fe={class:"template-media"},ye=["src"],Ce=s(()=>e("view",{class:"play-indicator"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"16",height:"16"},[e("path",{d:"M8 5v14l11-7z",fill:"currentColor"})])],-1)),be={class:"template-content"},ke={class:"content-top"},ze={class:"template-name"},Le={class:"content-bottom"},Be=["onClick"],Ve=s(()=>e("text",null,"使用形象",-1)),Me=[Ve],Ue={key:0,class:"video-dialog"},Te={class:"dialog-content"},$e=s(()=>e("text",{class:"dialog-title"},"视频预览",-1)),Ie=s(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"24",height:"24"},[e("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z",fill:"currentColor"})],-1)),Ne=[Ie],Se={class:"dialog-body"},Ee=["src"],He={class:"dialog-footer"},qe={__name:"index",setup(d){const x=R(),g=n(!1),r=n([]);n(!1);const p=n(null),c=n(null),v=n(!1),w=n(null),m=async()=>{try{g.value=!0;const t={};c.value&&(t.gender=c.value);const a=await D.get("/api/template/list",{params:t});a?r.value=(a||[]).map(_=>({..._,imageLoading:!0,imageError:!1})):(console.error("获取模板列表失败:",a),r.value=[])}catch(t){console.error("获取模板列表异常:",t),r.value=[]}finally{g.value=!1}},f=t=>{c.value===t?c.value=null:(c.value=t,p.value=null),m()},z=t=>{p.value=null,c.value=null,m()},L=t=>{w.value=t,v.value=!0},h=()=>{v.value=!1,setTimeout(()=>{w.value=null},300)},y=t=>{if(t)try{v.value&&h(),x.push({path:"/pages/avatar/clone",query:{videoUrl:t.videoUrl,avatarName:t.name||"数字人形象"}})}catch(a){console.error("跳转失败:",a),uni.showToast({title:"操作失败，请重试",icon:"none"})}};$(()=>{m()});const B=()=>{x.back()},V=t=>{if(!t)return"/static/images/avatar-placeholder.png";try{return t.split("?")[0]+"?x-oss-process=video/snapshot,t_0"}catch(a){return console.error("生成缩略图URL失败:",a),"/static/images/avatar-placeholder.png"}},M=t=>{t.target.src.includes("avatar-placeholder.png")||(console.error("图片加载失败:",t.target.src),t.target.src="/static/images/avatar-placeholder.png")};return(t,a)=>{var C;const _=E("scroll-view");return i(),l("view",P,[e("view",{class:"header-bar"},[e("view",{class:"back-button",onClick:B},J),K,O]),Q,e("view",W,[X,N(_,{class:"categories-scroll","scroll-x":"true","show-scrollbar":"false"},{default:S(()=>[e("view",Y,[e("view",{class:u(["category-item",{active:!p.value&&!c.value}]),onClick:a[0]||(a[0]=o=>z(null))},te,2),e("view",{class:u(["category-item",{active:c.value===1}]),onClick:a[1]||(a[1]=o=>f(1))},oe,2),e("view",{class:u(["category-item",{active:c.value===2}]),onClick:a[2]||(a[2]=o=>f(2))},ie,2)])]),_:1})]),e("view",ne,[g.value?(i(),l("view",re,we)):r.value.length===0?(i(),l("view",he,pe)):(i(),l("view",me,[(i(!0),l(H,null,q(r.value,o=>(i(),l("view",{key:o.id,class:"template-item",onClick:U=>L(o)},[e("view",fe,[e("img",{src:V(o.videoUrl),class:"template-image",alt:"视频缩略图",onError:M},null,40,ye),o.gender?(i(),l("view",{key:0,class:u(["gender-tag",o.gender===1?"male":"female"])},[e("text",null,k(o.gender===1?"男":"女"),1)],2)):b("",!0)]),Ce,e("view",be,[e("view",ke,[e("text",ze,k(o.name),1)]),e("view",Le,[e("view",{class:"use-btn",onClick:j(U=>y(o),["stop"])},Me,8,Be)])])],8,xe))),128))]))]),v.value?(i(),l("view",Ue,[e("view",{class:"dialog-overlay",onClick:h}),e("view",Te,[e("view",{class:"dialog-header"},[$e,e("view",{class:"dialog-close",onClick:h},Ne)]),e("view",Se,[e("video",{src:(C=w.value)==null?void 0:C.videoUrl,class:"preview-video",controls:"",autoplay:""},null,8,Ee)]),e("view",He,[e("view",{class:"dialog-button cancel",onClick:h},"关闭"),e("view",{class:"dialog-button confirm",onClick:a[3]||(a[3]=o=>y(w.value))},"使用")])])])):b("",!0)])}}},Re=T(qe,[["__scopeId","data-v-82dd3cea"]]);export{Re as default};
