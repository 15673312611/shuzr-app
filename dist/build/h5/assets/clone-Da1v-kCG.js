import{_ as me,a as n,o as J,x as ge,D as K,c as i,q as ee,b as e,g as E,w as H,v as Q,n as m,F as L,j as I,t as k,e as X,z as fe,p as ye,k as xe,u as ke,l}from"./index-DDlqzt3H.js";import{v as T,b as Ce}from"./services-GkRl5Aq9.js";import{u as Y}from"./oss-BBVvcpXL.js";import{s as r,a as be,h as Z}from"./toast-hozt1mdT.js";import"./request-CIZjav-Z.js";const a=V=>(ye("data-v-db62eaa0"),V=V(),xe(),V),Ve={class:"page-container"},ze=ee('<view class="bg-elements" data-v-db62eaa0><view class="bg-gradient" data-v-db62eaa0></view><view class="bg-grid" data-v-db62eaa0></view><view class="bg-circle circle1" data-v-db62eaa0></view><view class="bg-circle circle2" data-v-db62eaa0></view></view>',1),Me={class:"content-wrapper"},Be=a(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",width:"20",height:"20"},[e("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"})],-1)),Ue=[Be],Le=a(()=>e("view",{class:"header-title"},[e("text",{class:"title"},"创建新作品")],-1)),Ie=a(()=>e("view",{class:"placeholder-space"},null,-1)),Re={class:"form-container"},Ae={class:"form-section"},Se={class:"input-wrapper name-input"},Fe={class:"form-section"},Ee=a(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",width:"48",height:"48"},[e("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"})],-1)),He=[Ee],Te=a(()=>e("text",{class:"upload-desc"},"支持MP4、MOV等格式，大小不超过200MB",-1)),Oe=["src"],Pe=["src"],$e=a(()=>e("div",{class:"play-overlay"},[e("div",{class:"play-button"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",width:"48",height:"48"},[e("path",{d:"M8 5v14l11-7z"})])])],-1)),Ne=a(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",width:"20",height:"20"},[e("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})],-1)),De=[Ne],je={class:"voice-options"},qe={class:"form-section text-section"},We={key:0,class:"text-input-area"},Ge={class:"text-tools"},Je=a(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",width:"20",height:"20"},[e("path",{d:"M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"})],-1)),Ke={class:"text-counter"},Qe=a(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",width:"20",height:"20"},[e("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14h-2v-4H8V7h2v4h2V7h2v10z"})],-1)),Xe=a(()=>e("text",null,"写文案",-1)),Ye=[Qe,Xe],Ze={key:1,class:"audio-upload-area"},et=ee('<view class="upload-icon" data-v-db62eaa0><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="48" height="48" data-v-db62eaa0><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z" data-v-db62eaa0></path></svg></view><text class="upload-text" data-v-db62eaa0>点击上传音频文件</text><text class="upload-desc" data-v-db62eaa0>支持MP3、WAV等格式</text>',3),tt=[et],ot={key:1,class:"audio-file-preview"},st={class:"audio-file-info"},it=a(()=>e("view",{class:"audio-icon"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",width:"36",height:"36"},[e("path",{d:"M12 3v9.28c-.47-.17-.97-.28-1.5-.28C8.01 12 6 14.01 6 16.5S8.01 21 10.5 21c2.31 0 4.2-1.75 4.45-4H15V6h4V3h-7z"})])],-1)),lt={class:"audio-details"},at={class:"audio-name"},ct={class:"audio-size"},nt=a(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",width:"24",height:"24"},[e("path",{d:"M8 5v14l11-7z"})],-1)),vt=[nt],rt=a(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",width:"24",height:"24"},[e("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})],-1)),dt=[rt],ut={class:"form-footer"},ht=a(()=>e("text",null,"立即创建",-1)),wt=[ht],pt={key:0,class:"voice-modal"},_t={class:"voice-modal-content"},mt=a(()=>e("text",{class:"voice-modal-title"},"选择音色",-1)),gt=a(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",width:"24",height:"24"},[e("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})],-1)),ft=[gt],yt={class:"voice-tabs"},xt={class:"voice-list-container"},kt={key:0,class:"voice-list"},Ct=["onClick"],bt={class:"voice-indicator"},Vt={key:0,class:"indicator-dot"},zt={class:"voice-info"},Mt={class:"voice-name"},Bt=["onClick"],Ut={key:0,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",width:"24",height:"24"},Lt=a(()=>e("path",{d:"M8 5v14l11-7z"},null,-1)),It=[Lt],Rt={key:1,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",width:"24",height:"24"},At=a(()=>e("path",{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z"},null,-1)),St=[At],Ft={key:1,class:"voice-list"},Et=["onClick"],Ht={class:"voice-indicator"},Tt={key:0,class:"indicator-dot"},Ot={class:"voice-info"},Pt={class:"voice-name"},$t=["onClick"],Nt={key:0,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",width:"24",height:"24"},Dt=a(()=>e("path",{d:"M8 5v14l11-7z"},null,-1)),jt=[Dt],qt={key:1,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",width:"24",height:"24"},Wt=a(()=>e("path",{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z"},null,-1)),Gt=[Wt],Jt={class:"voice-modal-footer"},Kt=a(()=>e("div",{class:"video-title"},"视频预览",-1)),Qt=a(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",width:"24",height:"24"},[e("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})],-1)),Xt=[Qt],Yt={class:"video-container"},Zt={__name:"clone",setup(V){const O=ke(),z=ge(),g=n(""),c=n(""),M=n(null),R=n(!1);n(null);const C=n(null),P=n(!1),A=n(!1),y=n("system"),p=n("synthesize"),B=n([]),U=n([]),d=n(null),$=n(""),_=n(null),v=n(null),f=n(""),u=n(null);n("");const x=n(!1);J(()=>{const t=uni.getStorageSync("selected_text");t&&(f.value=t,uni.removeStorageSync("selected_text")),z.query.videoUrl&&(c.value=z.query.videoUrl,z.query.avatarName&&(g.value=z.query.avatarName+"的作品"))});const te=()=>{c.value&&(x.value=!0,setTimeout(()=>{const t=document.getElementById("previewVideoPlayer");t&&(t.onerror=null,t.src=c.value,t.load(),t.play().catch(s=>{console.error("视频播放失败:",s)}))},100))},N=()=>{try{const t=document.getElementById("previewVideoPlayer");t&&(t.pause(),t.onerror=null,t.onabort=null,t.src="",t.removeAttribute("src"),t.load()),x.value=!1}catch(t){console.error("关闭视频时出错:",t),x.value=!1}},oe=t=>{x.value&&(console.error("视频加载失败:",t),x.value&&r({title:"视频加载失败",icon:"none"}))},D=K(()=>p.value==="synthesize"?c.value&&d.value&&g.value&&f.value.trim().length>0:c.value&&u.value&&g.value),se=()=>{O.back()},j=()=>{if(c.value){if(confirm("确定要更换视频吗？")){const t=document.createElement("input");t.type="file",t.accept="video/*",t.onchange=s=>{const o=s.target.files[0];if(o){if(o.size>200*1024*1024){r({title:"视频大小不能超过200MB",icon:"none"});return}const h=new FileReader;h.onload=w=>{c.value=w.target.result,M.value=o,R.value=!1},h.readAsDataURL(o)}},t.click()}}else{const t=document.createElement("input");t.type="file",t.accept="video/*",t.onchange=s=>{const o=s.target.files[0];if(o){if(o.size>200*1024*1024){r({title:"视频大小不能超过200MB",icon:"none"});return}const h=new FileReader;h.onload=w=>{c.value=w.target.result,M.value=o,R.value=!1},h.readAsDataURL(o)}},t.click()}},ie=()=>{const t=document.createElement("input");t.type="file",t.accept="audio/*",t.onchange=s=>{const o=s.target.files[0];o&&(u.value={file:o,name:o.name,size:o.size,url:URL.createObjectURL(o)},r({title:"音频文件已选择",icon:"success"}))},t.click()},le=()=>{!u.value||!u.value.url||(v.value&&(v.value.pause(),v.value=null),v.value=new Audio(u.value.url),v.value.play().catch(t=>{console.error("播放音频失败:",t),r({title:"播放音频失败",icon:"none"})}))},ae=()=>{u.value&&u.value.url&&URL.revokeObjectURL(u.value.url),u.value=null,v.value&&(v.value.pause(),v.value=null)},ce=t=>{if(!t)return"0 B";const s=1024,o=["B","KB","MB","GB"],h=Math.floor(Math.log(t)/Math.log(s));return parseFloat((t/Math.pow(s,h)).toFixed(2))+" "+o[h]},ne=()=>{A.value=!0},S=()=>{A.value=!1},q=t=>{d.value=t.voiceId||t.id},ve=()=>{if(!d.value){r({title:"请选择音色",icon:"none"});return}const s=(y.value==="system"?B.value:U.value).find(o=>(o.voiceId||o.id)===d.value);s&&($.value=s.name),S()},re=()=>{r({title:"写文案功能开发中",icon:"none"})},W=async t=>{if((_.value===t.voiceId||_.value===t.id)&&v.value){v.value.pause(),v.value.currentTime=0,_.value=null;return}try{if(v.value&&(v.value.pause(),v.value.currentTime=0),!t.voiceUrl){console.error("音色没有可播放的URL"),r({title:"无法播放音色示例",icon:"none"});return}v.value=new Audio(t.voiceUrl),_.value=t.voiceId||t.id,await v.value.play(),v.value.onended=()=>{_.value=null}}catch(s){console.error("播放声音失败:",s),r({title:"播放声音失败",icon:"none"}),_.value=null}},de=async()=>{if(!D.value){g.value?c.value?p.value==="synthesize"?d.value?f.value.trim()||r({title:"请输入文案",icon:"none"}):r({title:"请选择音色",icon:"none"}):p.value==="upload"&&!u.value&&r({title:"请上传配音文件",icon:"none"}):r({title:"请选择分身视频",icon:"none"}):r({title:"请输入视频名称",icon:"none"});return}try{be("视频合成中...");const t=await Y(M.value,"digital-human/videos"),s=new URLSearchParams;if(s.append("name",g.value),s.append("videoUrl",t),p.value==="synthesize")s.append("text",f.value),s.append("voiceId",d.value),s.append("type","text");else if(p.value==="upload"&&u.value){const h=await Y(u.value.file,"digital-human/audios");s.append("audio",h),s.append("type","voice")}const o=await Ce.generate(s);Z(),console.log("创建响应类型:",typeof o),console.log("创建响应内容:",JSON.stringify(o)),console.log("响应code:",o==null?void 0:o.code),console.log("响应code类型:",typeof(o==null?void 0:o.code)),console.log("判断结果:",!!(o&&o.code===200)),r({title:"视频合成任务已提交",icon:"success"}),setTimeout(()=>{O.push("/pages/works/index")},1500)}catch(t){console.error("创建错误:",t),Z(),r({title:t.message||"创建失败，请重试",icon:"none"})}};J(()=>{ue()});const ue=async()=>{try{const t=await T.getFavoriteVoiceList();let s=[];t&&Array.isArray(t)&&(s=t.map(b=>({...b,isFavorite:!0})));const o=await T.getHotVoiceList();let h=[];o&&Array.isArray(o)&&(h=o);const w=[...s];h.forEach(b=>{w.some(G=>G.voiceId===b.voiceId||G.id===b.id)||w.push(b)}),B.value=w;const F=await T.getMyVoiceList();F&&Array.isArray(F)&&(U.value=F)}catch(t){console.error("获取音色列表失败:",t),B.value=[{id:1,name:"温柔女声",voiceUrl:"https://example.com/voice1.mp3"},{id:2,name:"讲解女声",voiceUrl:"https://example.com/voice2.mp3"},{id:3,name:"带货嗓音",voiceUrl:"https://example.com/voice3.mp3"},{id:4,name:"女大学生",voiceUrl:"https://example.com/voice4.mp3"},{id:5,name:"信息流小哥",voiceUrl:"https://example.com/voice5.mp3"}],U.value=[{id:101,name:"我的音色1",voiceUrl:"https://example.com/custom1.mp3"},{id:102,name:"我的音色2",voiceUrl:"https://example.com/custom2.mp3"}]}},he=()=>{C.value&&(C.value.pause(),C.value.src="",C.value.load()),c.value="",M.value=null,R.value=!1,P.value=!1,c.value&&c.value.startsWith("blob:")&&URL.revokeObjectURL(c.value),console.log("视频已移除")},we=t=>{if(!t)return"/static/images/avatar-placeholder.png";try{return t.split("?")[0]+"?x-oss-process=video/snapshot,t_0"}catch(s){return console.error("生成缩略图URL失败:",s),"/static/images/avatar-placeholder.png"}},pe=t=>{t.target.src.includes("avatar-placeholder.png")||(console.error("图片加载失败:",t.target.src),t.target.src="/static/images/avatar-placeholder.png")},_e=K(()=>c.value&&(c.value.startsWith("blob:")||c.value.startsWith("data:")));return(t,s)=>(l(),i("view",Ve,[ze,e("view",Me,[e("view",{class:"header-bar"},[e("view",{class:"back-button",onClick:se},Ue),Le,Ie]),e("view",Re,[e("view",Ae,[e("view",Se,[H(e("input",{"onUpdate:modelValue":s[0]||(s[0]=o=>g.value=o),type:"text",placeholder:"请输入视频名称",class:"text-field"},null,512),[[Q,g.value]])])]),e("view",Fe,[e("view",{class:m(["upload-area",{"has-video":c.value}])},[c.value?(l(),i(L,{key:1},[e("div",{class:"video-thumbnail",onClick:te},[_e.value?(l(),i("video",{key:0,ref_key:"previewVideoRef",ref:C,class:"preview-video",src:c.value,muted:"",preload:"metadata",onLoadedmetadata:s[1]||(s[1]=o=>P.value=!0)},null,40,Oe)):(l(),i("img",{key:1,class:"preview-video",src:we(c.value),loading:"lazy",onError:s[2]||(s[2]=o=>pe(o))},null,40,Pe)),$e]),e("div",{class:"remove-video",onClick:I(he,["stop"])},De)],64)):(l(),i(L,{key:0},[e("view",{class:"upload-icon",onClick:j},He),e("text",{class:"upload-text",onClick:j},"上传视频"),Te],64))],2)]),e("view",je,[e("view",{class:m(["voice-option-tab",{active:p.value==="synthesize"}]),onClick:s[3]||(s[3]=o=>p.value="synthesize")}," 合成配音 ",2),e("view",{class:m(["voice-option-tab",{active:p.value==="upload"}]),onClick:s[4]||(s[4]=o=>p.value="upload")}," 上传配音 ",2)]),e("view",qe,[p.value==="synthesize"?(l(),i("view",We,[H(e("textarea",{"onUpdate:modelValue":s[5]||(s[5]=o=>f.value=o),placeholder:"请输入文案",class:"text-input",maxlength:"450"},null,512),[[Q,f.value]]),e("view",Ge,[e("view",{class:"voice-select-tool",onClick:ne},[Je,e("text",null,k($.value||"选择音色"),1)]),e("view",Ke,k(f.value.length)+"/450",1),e("view",{class:"ai-write-tool",onClick:re},Ye)])])):(l(),i("view",Ze,[u.value?(l(),i("view",ot,[e("view",st,[it,e("view",lt,[e("text",at,k(u.value.name||"音频文件"),1),e("text",ct,k(ce(u.value.size)),1)])]),e("view",{class:"audio-actions"},[e("view",{class:"audio-play",onClick:le},vt),e("view",{class:"audio-remove",onClick:ae},dt)])])):(l(),i("view",{key:0,class:"audio-upload-content",onClick:ie},tt))]))]),e("view",ut,[e("view",{class:m(["submit-button",{disabled:!D.value}]),onClick:de},wt,2)])])]),A.value?(l(),i("view",pt,[e("view",{class:"voice-modal-mask",onClick:S}),e("view",_t,[e("view",{class:"voice-modal-header"},[mt,e("view",{class:"voice-modal-close",onClick:S},ft)]),e("view",yt,[e("view",{class:m(["voice-tab",{active:y.value==="system"}]),onClick:s[6]||(s[6]=o=>y.value="system")}," 系统音色 ",2),e("view",{class:m(["voice-tab",{active:y.value==="custom"}]),onClick:s[7]||(s[7]=o=>y.value="custom")}," 自定义音色 ",2)]),e("view",xt,[y.value==="system"?(l(),i("div",kt,[(l(!0),i(L,null,X(B.value,(o,h)=>(l(),i("view",{key:"system-"+o.id,class:m(["voice-option",{selected:d.value===o.voiceId||d.value===o.id}]),onClick:w=>q(o)},[e("view",bt,[d.value===o.voiceId||d.value===o.id?(l(),i("view",Vt)):E("",!0)]),e("view",zt,[e("text",Mt,k(o.name),1)]),e("view",{class:"voice-play",onClick:I(w=>W(o),["stop"])},[_.value!==o.voiceId&&_.value!==o.id?(l(),i("svg",Ut,It)):(l(),i("svg",Rt,St))],8,Bt)],10,Ct))),128))])):(l(),i("div",Ft,[(l(!0),i(L,null,X(U.value,(o,h)=>(l(),i("view",{key:"custom-"+o.id,class:m(["voice-option",{selected:d.value===o.voiceId||d.value===o.id}]),onClick:w=>q(o)},[e("view",Ht,[d.value===o.voiceId||d.value===o.id?(l(),i("view",Tt)):E("",!0)]),e("view",Ot,[e("text",Pt,k(o.name),1)]),e("view",{class:"voice-play",onClick:I(w=>W(o),["stop"])},[_.value!==o.voiceId&&_.value!==o.id?(l(),i("svg",Nt,jt)):(l(),i("svg",qt,Gt))],8,$t)],10,Et))),128))]))]),e("view",Jt,[e("view",{class:m(["confirm-button",{disabled:!d.value}]),onClick:ve}," 确认 ",2)])])])):E("",!0),H(e("div",{class:"video-modal",onClick:N},[e("div",{class:"video-modal-content",onClick:s[8]||(s[8]=I(()=>{},["stop"]))},[e("div",{class:"video-modal-header"},[Kt,e("div",{class:"close-button",onClick:N},Xt)]),e("div",Yt,[e("video",{id:"previewVideoPlayer",controls:"",autoplay:"",class:"video-player",onError:oe},null,32)])])],512),[[fe,x.value]])]))}},lo=me(Zt,[["__scopeId","data-v-db62eaa0"]]);export{lo as default};
