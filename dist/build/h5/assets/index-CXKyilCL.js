import{_ as I,r as S,a as r,o as C,c as i,b as e,d as g,F as A,e as T,f as z,w as h,g as x,v as U,h as V,n as v,i as M,j as N,p as $,k as B,u as D,l as a}from"./index-DDlqzt3H.js";import{u as E}from"./services-GkRl5Aq9.js";import{U as F}from"./UserAgreementModal-BtgWJLAP.js";import"./request-CIZjav-Z.js";const o=u=>($("data-v-2e82f15c"),u=u(),B(),u),J={class:"login-container"},L={class:"animated-bg"},O=o(()=>e("view",{class:"glow-circle circle-1"},null,-1)),R=o(()=>e("view",{class:"glow-circle circle-2"},null,-1)),j=o(()=>e("view",{class:"glow-circle circle-3"},null,-1)),P={class:"floating-particles"},q={class:"content-wrapper"},G={class:"title-area"},H={class:"logo-container"},K=o(()=>e("view",{class:"logo-glow"},null,-1)),Q=o(()=>e("text",{class:"title"},"数字人平台",-1)),W=o(()=>e("text",{class:"subtitle"},"让创作更简单",-1)),X={class:"form-area"},Y=o(()=>e("view",{class:"form-header"},[e("text",{class:"form-title"},"登录"),e("text",{class:"form-subtitle"},"欢迎回来")],-1)),Z={class:"input-item"},ee=o(()=>e("view",{class:"input-icon"},[e("text",{class:"iconfont icon-account",style:{color:"#3ef7c8","font-size":"22px"}})],-1)),se=o(()=>e("text",{class:"iconfont icon-close",style:{color:"#7A7A7A","font-size":"18px"}},null,-1)),te=[se],oe={class:"input-item"},le=o(()=>e("view",{class:"input-icon"},[e("text",{class:"iconfont icon-lock",style:{color:"#3ef7c8","font-size":"22px"}})],-1)),ne=["type"],ie={class:"agreement-row"},ae={key:0,class:"iconfont icon-check",style:{color:"#000","font-size":"12px"}},ce={style:{color:"#bbbbbb","margin-left":"8px"}},re=o(()=>e("view",{class:"spacer-element"},null,-1)),ue={class:"btn-wrapper"},de={key:0},me={key:1,class:"loading-spinner"},pe=o(()=>e("view",{class:"btn-glow"},null,-1)),_e=o(()=>e("text",null,"还没有账号?",-1)),ve={__name:"index",setup(u){const w=D(),t=S({username:"",password:""}),d=r(!1),f=r(!1),m=r(!1),p=r(!1),c=r(!1),b=()=>{d.value=!d.value},k=async()=>{try{if(!t.username||!t.password){uni.showToast({title:"请输入用户名和密码",icon:"none"});return}if(!c.value){uni.showToast({title:"请阅读并同意用户协议",icon:"none"});return}m.value=!0;const n={username:t.username,password:t.password},s=await E.login(n);if(console.log("登录响应:",s),s&&s.token){if(localStorage.setItem("token",s.token),localStorage.setItem("userId",s.userId||s.id||"1"),s.user)localStorage.setItem("user",JSON.stringify(s.user));else{const _={id:s.userId||s.id||"1",username:s.username||t.username};localStorage.setItem("user",JSON.stringify(_))}f.value?localStorage.setItem("rememberedUsername",t.username):localStorage.removeItem("rememberedUsername"),uni.showToast({title:"登录成功",icon:"success"}),setTimeout(()=>{w.push("/pages/index/index")},1500)}else throw new Error("登录失败，请重试")}catch(n){console.error("登录失败:",n),uni.showToast({title:n.message||"登录失败，请重试",icon:"none"})}finally{m.value=!1}},y=()=>{w.push("/pages/register/index")};return C(()=>{const n=localStorage.getItem("rememberedUsername");n&&(t.username=n,f.value=!0)}),(n,s)=>{const _=z("u-avatar");return a(),i("view",J,[e("view",L,[O,R,j,e("view",P,[(a(),i(A,null,T(20,l=>e("view",{class:"particle",key:l})),64))])]),e("view",q,[e("view",G,[e("view",H,[K,g(_,{size:"80",icon:"home-fill",fontSize:"40",color:"#000",bgColor:"#3ef7c8"})]),Q,W]),e("view",X,[Y,e("view",Z,[ee,h(e("input",{type:"text","onUpdate:modelValue":s[0]||(s[0]=l=>t.username=l),placeholder:"请输入用户名","placeholder-style":"color: #666666",class:"input-field"},null,512),[[U,t.username]]),t.username?(a(),i("view",{key:0,class:"input-clear",onClick:s[1]||(s[1]=l=>t.username="")},te)):x("",!0)]),e("view",oe,[le,h(e("input",{type:d.value?"text":"password","onUpdate:modelValue":s[2]||(s[2]=l=>t.password=l),placeholder:"请输入密码","placeholder-style":"color: #666666",class:"input-field"},null,8,ne),[[V,t.password]]),e("view",{class:"input-clear",onClick:b},[e("text",{class:v(["iconfont",d.value?"icon-eye-fill":"icon-eye-off"]),style:{color:"#7A7A7A","font-size":"18px"}},null,2)])]),e("view",ie,[e("view",{class:"checkbox-container",onClick:s[4]||(s[4]=l=>c.value=!c.value)},[e("view",{class:v(["checkbox",{"checkbox-active":c.value}])},[c.value?(a(),i("text",ae)):x("",!0)],2),e("text",ce,[M(" 我已阅读并同意 "),e("text",{class:"agreement-link",onClick:s[3]||(s[3]=N(l=>p.value=!0,["stop"]))},"《用户协议》")])])]),re,e("view",ue,[e("button",{class:v(["login-btn",{"login-btn-loading":m.value}]),onClick:k},[m.value?(a(),i("view",me)):(a(),i("text",de,"立即登录"))],2),pe]),e("view",{class:"register-link"},[_e,e("text",{class:"link",onClick:y},"立即注册")])])]),g(F,{visible:p.value,onClose:s[5]||(s[5]=l=>p.value=!1)},null,8,["visible"])])}}},xe=I(ve,[["__scopeId","data-v-2e82f15c"]]);export{xe as default};
